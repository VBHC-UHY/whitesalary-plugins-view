<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™½çš„æ’ä»¶å¸‚åœº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans SC', sans-serif; }
        body {
            background: linear-gradient(180deg, #fdf4ff 0%, #faf5ff 50%, #f5f3ff 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.9);
        }
        .hero-gradient {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #6366f1 100%);
        }
        .plugin-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .plugin-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(139, 92, 246, 0.25);
        }
        .featured-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #fbbf24;
        }
        .btn-primary {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px -10px rgba(139, 92, 246, 0.5);
        }
        .search-box:focus-within {
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }
        .float { animation: float 4s ease-in-out infinite; }
        .category-pill {
            transition: all 0.2s ease;
        }
        .category-pill:hover {
            transform: scale(1.05);
        }
        .category-pill.active {
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 4px 15px -3px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="glass-card sticky top-0 z-50 border-b border-purple-100">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white text-xl">
                    ğŸª
                </div>
                <span class="font-bold text-xl bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
                    ç™½çš„æ’ä»¶å¸‚åœº
                </span>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="goToLocalMarket()" class="px-4 py-2 rounded-xl bg-purple-100 text-purple-700 font-medium hover:bg-purple-200 transition-all flex items-center gap-2">
                    <span>ğŸ </span> æœ¬åœ°å¸‚åœº
                </button>
                <a href="https://whitesalary-plugins-web.vercel.app" target="_blank" class="btn-primary px-4 py-2 rounded-xl text-white font-medium flex items-center gap-2">
                    <span>ğŸ“¤</span> æäº¤æ’ä»¶
                </a>
            </div>
        </div>
    </nav>

    <!-- è‹±é›„åŒºåŸŸ -->
    <div class="hero-gradient text-white py-16 px-4 relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-10 left-10 w-32 h-32 bg-white rounded-full blur-3xl"></div>
            <div class="absolute bottom-10 right-10 w-48 h-48 bg-pink-300 rounded-full blur-3xl"></div>
            <div class="absolute top-1/2 left-1/2 w-64 h-64 bg-purple-300 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"></div>
        </div>
        <div class="max-w-7xl mx-auto relative z-10">
            <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                <div>
                    <h1 class="text-5xl font-black mb-4">å‘ç°ç²¾å½©æ’ä»¶</h1>
                    <p class="text-xl text-white/80 mb-6">ä¸ºç™½æ‰“é€ çš„æ‰©å±•åŠŸèƒ½ä¸­å¿ƒï¼Œè®©ç™½å˜å¾—æ›´å¼ºå¤§</p>
                    <div class="flex gap-6">
                        <div class="text-center">
                            <div class="text-4xl font-bold" id="plugin-count">-</div>
                            <div class="text-sm text-white/70">å¯ç”¨æ’ä»¶</div>
                        </div>
                        <div class="w-px bg-white/20"></div>
                        <div class="text-center">
                            <div class="text-4xl font-bold" id="featured-count">-</div>
                            <div class="text-sm text-white/70">ç²¾é€‰æ¨è</div>
                        </div>
                        <div class="w-px bg-white/20"></div>
                        <div class="text-center">
                            <div class="text-4xl font-bold" id="category-count">-</div>
                            <div class="text-sm text-white/70">æ’ä»¶åˆ†ç±»</div>
                        </div>
                    </div>
                </div>
                <div class="text-9xl float">ğŸ</div>
            </div>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- æœç´¢æ  -->
        <div class="glass-card rounded-2xl p-4 mb-8 search-box transition-all">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1 relative">
                    <input type="text" id="search-input" placeholder="æœç´¢ä½ æƒ³è¦çš„æ’ä»¶..."
                           class="w-full pl-12 pr-4 py-4 rounded-xl bg-white border-0 focus:outline-none text-lg">
                    <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <select id="category-filter" class="px-6 py-4 rounded-xl bg-white border-0 focus:outline-none text-gray-700 font-medium cursor-pointer">
                    <option value="all">ğŸ·ï¸ å…¨éƒ¨åˆ†ç±»</option>
                </select>
            </div>
        </div>

        <!-- åˆ†ç±»æ ‡ç­¾ -->
        <div class="flex flex-wrap gap-2 mb-8" id="category-pills">
            <button onclick="filterByCategory('all')" class="category-pill active px-4 py-2 rounded-full bg-white text-gray-600 font-medium">
                å…¨éƒ¨
            </button>
        </div>

        <!-- ç²¾é€‰æ¨è -->
        <div id="featured-section" class="mb-12 hidden">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-white text-xl">â­</div>
                <h2 class="text-2xl font-bold text-gray-800">ç²¾é€‰æ¨è</h2>
            </div>
            <div id="featured-plugins" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <!-- æ‰€æœ‰æ’ä»¶ -->
        <div>
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white text-xl">ğŸ“¦</div>
                    <h2 class="text-2xl font-bold text-gray-800">å…¨éƒ¨æ’ä»¶</h2>
                    <span class="text-gray-400 text-lg" id="filtered-count"></span>
                </div>
            </div>
            <div id="plugins-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <div class="col-span-full text-center py-20">
                    <div class="text-6xl mb-4">â³</div>
                    <p class="text-gray-500 text-lg">æ­£åœ¨åŠ è½½æ’ä»¶...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ’ä»¶è¯¦æƒ…å¼¹çª— -->
    <div id="detail-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 hidden">
        <div class="glass-card rounded-3xl w-full max-w-2xl max-h-[85vh] overflow-hidden shadow-2xl">
            <div id="detail-header" class="p-8 bg-gradient-to-r from-pink-50 to-purple-50"></div>
            <div id="detail-content" class="p-8 overflow-y-auto bg-white" style="max-height: calc(85vh - 250px);"></div>
            <div class="p-6 border-t border-gray-100 bg-gray-50 flex items-center justify-end gap-4">
                <button onclick="closeDetail()" class="px-6 py-3 rounded-xl border border-gray-200 text-gray-600 hover:bg-white transition-colors font-medium">
                    å…³é—­
                </button>
                <button id="install-btn" onclick="tryInstall()" class="btn-primary px-8 py-3 rounded-xl text-white font-medium">
                    ğŸš€ å®‰è£…åˆ°æœ¬åœ°
                </button>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ -->
    <footer class="bg-white/50 border-t border-purple-100 mt-12">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white">ğŸª</div>
                    <span class="font-bold text-gray-800">ç™½çš„æ’ä»¶å¸‚åœº</span>
                </div>
                <div class="flex items-center gap-6 text-sm text-gray-500">
                    <a href="https://github.com/VBHC-UHY/whitesalary-plugins" target="_blank" class="hover:text-purple-600 transition-colors">ğŸ“‚ GitHub</a>
                    <a href="https://whitesalary-plugins-web.vercel.app" target="_blank" class="hover:text-purple-600 transition-colors">ğŸ“¤ æäº¤æ’ä»¶</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/VBHC-UHY/whitesalary-plugins/main/plugins.json';
        const LOCAL_WEBUI_URL = 'http://127.0.0.1:18266';
        
        let allPlugins = [];
        let selectedPlugin = null;
        let currentCategory = 'all';
        
        const categoryConfig = {
            'å¨±ä¹': { icon: 'ğŸ®', color: '#ec4899', bg: '#fce7f3' },
            'å¨±ä¹æ¸¸æˆ': { icon: 'ğŸ®', color: '#ec4899', bg: '#fce7f3' },
            'å®ç”¨': { icon: 'ğŸ› ï¸', color: '#3b82f6', bg: '#dbeafe' },
            'å®ç”¨å·¥å…·': { icon: 'ğŸ› ï¸', color: '#3b82f6', bg: '#dbeafe' },
            'ç¤¾äº¤': { icon: 'ğŸ’¬', color: '#10b981', bg: '#d1fae5' },
            'ç¤¾äº¤äº’åŠ¨': { icon: 'ğŸ’¬', color: '#10b981', bg: '#d1fae5' },
            'å¤©æ°”': { icon: 'ğŸŒ¤ï¸', color: '#0ea5e9', bg: '#e0f2fe' },
            'å¤©æ°”æ—¥å†': { icon: 'ğŸŒ¤ï¸', color: '#0ea5e9', bg: '#e0f2fe' },
            'ç¿»è¯‘': { icon: 'ğŸŒ', color: '#14b8a6', bg: '#ccfbf1' },
            'ç¿»è¯‘è¯­è¨€': { icon: 'ğŸŒ', color: '#14b8a6', bg: '#ccfbf1' },
            'å…¶ä»–': { icon: 'ğŸ“¦', color: '#9ca3af', bg: '#f3f4f6' }
        };
        
        async function init() {
            try {
                const response = await fetch(GITHUB_RAW_URL + '?t=' + Date.now());
                const data = await response.json();
                allPlugins = data.plugins || [];
                
                document.getElementById('plugin-count').textContent = allPlugins.length;
                const featuredCount = allPlugins.filter(p => p.featured).length;
                document.getElementById('featured-count').textContent = featuredCount;
                
                const categories = [...new Set(allPlugins.map(p => p.category))];
                document.getElementById('category-count').textContent = categories.length;
                
                // å¡«å……åˆ†ç±»é€‰æ‹©å™¨å’Œæ ‡ç­¾
                const categorySelect = document.getElementById('category-filter');
                const categoryPills = document.getElementById('category-pills');
                
                categories.forEach(cat => {
                    const cfg = categoryConfig[cat] || categoryConfig['å…¶ä»–'];
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cfg.icon + ' ' + cat;
                    categorySelect.appendChild(option);
                    
                    const pill = document.createElement('button');
                    pill.className = 'category-pill px-4 py-2 rounded-full bg-white text-gray-600 font-medium';
                    pill.onclick = () => filterByCategory(cat);
                    pill.innerHTML = cfg.icon + ' ' + cat;
                    pill.dataset.category = cat;
                    categoryPills.appendChild(pill);
                });
                
                renderPlugins();
                renderFeatured();
                
            } catch (error) {
                document.getElementById('plugins-list').innerHTML = 
                    '<div class="col-span-full text-center py-20">' +
                    '<div class="text-6xl mb-4">ğŸ˜¢</div>' +
                    '<p class="text-gray-500 text-lg">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>' +
                    '<p class="text-gray-400 text-sm mt-2">' + error.message + '</p>' +
                    '</div>';
            }
        }
        
        function filterByCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.category-pill').forEach(pill => {
                if (pill.dataset.category === category || (category === 'all' && !pill.dataset.category)) {
                    pill.classList.add('active');
                } else {
                    pill.classList.remove('active');
                }
            });
            
            document.getElementById('category-filter').value = category;
            renderPlugins();
        }
        
        function renderFeatured() {
            const featured = allPlugins.filter(p => p.featured);
            if (featured.length === 0) return;
            
            document.getElementById('featured-section').classList.remove('hidden');
            document.getElementById('featured-plugins').innerHTML = featured.map(p => createPluginCard(p, true)).join('');
        }
        
        function renderPlugins() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const category = currentCategory;
            
            let filtered = allPlugins;
            
            if (search) {
                filtered = filtered.filter(p => 
                    (p.cn_name || '').toLowerCase().includes(search) ||
                    (p.name || '').toLowerCase().includes(search) ||
                    (p.description || '').toLowerCase().includes(search)
                );
            }
            
            if (category !== 'all') {
                filtered = filtered.filter(p => p.category === category);
            }
            
            document.getElementById('filtered-count').textContent = '(' + filtered.length + 'ä¸ª)';
            
            if (filtered.length === 0) {
                document.getElementById('plugins-list').innerHTML = 
                    '<div class="col-span-full text-center py-20">' +
                    '<div class="text-6xl mb-4">ğŸ”</div>' +
                    '<p class="text-gray-500 text-lg">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ’ä»¶</p>' +
                    '</div>';
                return;
            }
            
            document.getElementById('plugins-list').innerHTML = filtered.map(p => createPluginCard(p)).join('');
        }
        
        function createPluginCard(plugin, isFeatured) {
            const cat = categoryConfig[plugin.category] || categoryConfig['å…¶ä»–'];
            
            return '<div onclick="showDetail(\'' + plugin.id + '\')" class="plugin-card ' + 
                   (isFeatured ? 'featured-card' : 'glass-card') + 
                   ' rounded-2xl p-6 cursor-pointer">' +
                   '<div class="flex items-start gap-4 mb-4">' +
                   '<div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl" style="background:' + cat.bg + '">' + cat.icon + '</div>' +
                   '<div class="flex-1 min-w-0">' +
                   '<div class="flex items-center gap-2">' +
                   '<h3 class="font-bold text-gray-800 text-lg truncate">' + (plugin.cn_name || plugin.name) + '</h3>' +
                   (isFeatured ? '<span class="bg-amber-400 text-white text-xs px-2 py-0.5 rounded-full">ç²¾é€‰</span>' : '') +
                   '</div>' +
                   '<p class="text-sm text-gray-500">v' + plugin.version + ' Â· ' + plugin.author + '</p>' +
                   '</div></div>' +
                   '<p class="text-gray-600 mb-4 line-clamp-2">' + plugin.description + '</p>' +
                   '<div class="flex items-center justify-between text-sm">' +
                   '<span class="px-3 py-1 rounded-full text-xs font-medium" style="background:' + cat.bg + ';color:' + cat.color + '">' + cat.icon + ' ' + plugin.category + '</span>' +
                   '<div class="flex items-center gap-3 text-gray-400">' +
                   '<span>â¬‡ï¸ ' + (plugin.downloads || 0) + '</span>' +
                   '<span>â­ ' + (plugin.rating || '5.0') + '</span>' +
                   '</div></div></div>';
        }
        
        function showDetail(pluginId) {
            selectedPlugin = allPlugins.find(p => p.id === pluginId);
            if (!selectedPlugin) return;
            
            const cat = categoryConfig[selectedPlugin.category] || categoryConfig['å…¶ä»–'];
            
            document.getElementById('detail-header').innerHTML = 
                '<div class="flex items-start gap-6">' +
                '<div class="w-24 h-24 rounded-3xl flex items-center justify-center text-5xl shadow-lg" style="background:' + cat.bg + '">' + cat.icon + '</div>' +
                '<div class="flex-1">' +
                '<div class="flex items-center gap-3 mb-2">' +
                '<h2 class="text-3xl font-bold text-gray-800">' + (selectedPlugin.cn_name || selectedPlugin.name) + '</h2>' +
                (selectedPlugin.featured ? '<span class="bg-amber-400 text-white text-sm px-3 py-1 rounded-full">â­ ç²¾é€‰</span>' : '') +
                '</div>' +
                '<p class="text-gray-500 mb-3">ğŸ“¦ v' + selectedPlugin.version + ' Â· ğŸ‘¤ ' + selectedPlugin.author + '</p>' +
                '<div class="flex items-center gap-4">' +
                '<span class="text-gray-500">â¬‡ï¸ ' + (selectedPlugin.downloads || 0) + ' ä¸‹è½½</span>' +
                '<span class="text-gray-500">â­ ' + (selectedPlugin.rating || '5.0') + ' åˆ†</span>' +
                '<span class="px-3 py-1 rounded-full text-sm" style="background:' + cat.bg + ';color:' + cat.color + '">' + cat.icon + ' ' + selectedPlugin.category + '</span>' +
                '</div></div></div>';
            
            let contentHtml = '<div class="space-y-6">';
            
            contentHtml += '<div><h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2"><span class="text-xl">ğŸ“</span> æ’ä»¶ä»‹ç»</h3>' +
                          '<p class="text-gray-600 leading-relaxed bg-gray-50 p-4 rounded-xl">' + (selectedPlugin.full_description || selectedPlugin.description) + '</p></div>';
            
            if (selectedPlugin.features && selectedPlugin.features.length > 0) {
                contentHtml += '<div><h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2"><span class="text-xl">âœ¨</span> åŠŸèƒ½ç‰¹è‰²</h3>' +
                              '<div class="grid gap-2">' +
                              selectedPlugin.features.map(f => '<div class="flex items-center gap-2 bg-green-50 text-green-700 px-4 py-2 rounded-lg"><span>âœ“</span> ' + f + '</div>').join('') +
                              '</div></div>';
            }
            
            if (selectedPlugin.usage) {
                contentHtml += '<div><h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2"><span class="text-xl">ğŸ’¡</span> ä½¿ç”¨æ–¹æ³•</h3>' +
                              '<div class="bg-blue-50 text-blue-700 p-4 rounded-xl">' + selectedPlugin.usage + '</div></div>';
            }
            
            if (selectedPlugin.commands && selectedPlugin.commands.length > 0) {
                contentHtml += '<div><h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2"><span class="text-xl">âŒ¨ï¸</span> è§¦å‘å‘½ä»¤</h3>' +
                              '<div class="flex flex-wrap gap-2">' +
                              selectedPlugin.commands.map(c => '<code class="bg-purple-50 text-purple-600 px-3 py-1.5 rounded-lg">' + c + '</code>').join('') +
                              '</div></div>';
            }
            
            contentHtml += '</div>';
            
            document.getElementById('detail-content').innerHTML = contentHtml;
            document.getElementById('detail-modal').classList.remove('hidden');
        }
        
        function closeDetail() {
            document.getElementById('detail-modal').classList.add('hidden');
            selectedPlugin = null;
        }
        
        async function tryInstall() {
            if (!selectedPlugin) return;
            
            const btn = document.getElementById('install-btn');
            btn.textContent = 'â³ è¿æ¥ä¸­...';
            btn.disabled = true;
            
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 2000);
                
                await fetch(LOCAL_WEBUI_URL + '/api/status', { signal: controller.signal, mode: 'no-cors' });
                window.open(LOCAL_WEBUI_URL + '/plugins/market?install=' + selectedPlugin.id, '_blank');
                btn.textContent = 'ğŸš€ å®‰è£…åˆ°æœ¬åœ°';
                btn.disabled = false;
            } catch (error) {
                btn.textContent = 'ğŸš€ å®‰è£…åˆ°æœ¬åœ°';
                btn.disabled = false;
                alert('âŒ æ— æ³•è¿æ¥åˆ°æœ¬åœ°æœåŠ¡\\n\\nè¯·å…ˆå¯åŠ¨ WhiteSalaryï¼Œç„¶åå†å®‰è£…æ’ä»¶ã€‚\\n\\næœ¬åœ°åœ°å€ï¼š' + LOCAL_WEBUI_URL);
            }
        }
        
        async function goToLocalMarket() {
            try {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), 2000);
                await fetch(LOCAL_WEBUI_URL + '/api/status', { signal: controller.signal, mode: 'no-cors' });
                window.open(LOCAL_WEBUI_URL + '/plugins/market', '_blank');
            } catch (error) {
                alert('âŒ æ— æ³•è¿æ¥åˆ°æœ¬åœ°æœåŠ¡\\n\\nè¯·å…ˆå¯åŠ¨ WhiteSalaryã€‚\\n\\næœ¬åœ°åœ°å€ï¼š' + LOCAL_WEBUI_URL);
            }
        }
        
        document.getElementById('detail-modal').addEventListener('click', function(e) {
            if (e.target === this) closeDetail();
        });
        
        document.getElementById('search-input').addEventListener('input', renderPlugins);
        document.getElementById('category-filter').addEventListener('change', function() {
            filterByCategory(this.value);
        });
        
        init();
    </script>
</body>
</html>
